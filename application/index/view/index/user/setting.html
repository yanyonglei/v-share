<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>账号设置</title>

    <link rel="stylesheet" href="__CSS_PATH__/common.css">
    <link rel="stylesheet" href="__CSS_PATH__/element-ui_1.css">
    <link rel="stylesheet" type="text/css" href="__CSS_PATH__/Huploadify.css">
	 <script src="__JS_PATH__/jQuery-1.11.3.min.js"></script>

    <link rel="stylesheet" type="text/css" href="__CSS_PATH__/sweet-alert.css">
    <script src="__JS_PATH__/sweet-alert.min.js"></script>
</head>
<body>
<!-- 用户中心 - 新片场 -->

<!--     这是 master 的侧边栏。
 -->

<i class="font-icon-pre el-icon-edit" style="width: 0px; height: 0px; font-size: 0px; position: absolute;"></i>

<div class="header">

    <div class="header-center">
        <a href="">
            <span class="logo title">
            </span>
        </a>
        <span class="title">账号设置</span>

        <a class="login-out-sure" href="{:url('/?s=index/auth/loginOut')}">退出账号</a>
        <a href="/?s=index/user/index" class="login-out-sure">个人主页</a>

    </div>

</div>


<div>
    
         <!-- <span>This is my body content.</span> -->
    <style>
/* Code tidied up by ScrapBook */
body { overflow-y: scroll; }
.set-detail { margin-left: 270px; width: 640px; padding: 30px 40px; }
.set-detail .set-item:first-child { margin: 40px 0px !important; }
.set-detail .set-item .label { width: 140px; text-indent: 0px; }
.set-detail .set-item div { margin-left: 140px; }
.set-detail .set-item div span { width: 128px; }
.set-detail .set-item textarea { max-width: 500px; }
.set-ground .set-save { width: 300px; margin-left: 140px; }
</style>
    <div class="set-ground clearfix">
        
        <ul class="set-tab">
            <li class="cur" data-anchor="base">个人资料</li>

        </ul>
            
        <div class="set-detail" style="padding-bottom: 60px;">
            <h5>个人资料</h5>
    <div class="set-item" style="margin-bottom: 40px;">
		<span class="label" style="line-height: 120px;">头像</span>
		<div>
			<em class="avatar-change">

				<img src="{$userInfo['picture']}"  id="myImg" alt="">
			</em>

		</div>
	</div>
		<div class="">
			<span class="label">修改头像</span>
            <input type="file" name="myfile" id="id-publish-btn" onchange="uploadImage()"/>
		</div>

            <div class="set-item clearfix">
                <span class="label">用户名<i class="nes-red">*</i></span>

                <div class="action-item nickname-item " style="height: 44px; line-height: 44px;">
                    <input class="nickname" name="nickname" placeholder="用户名" type="text" value="{$userInfo['username']}">

                </div>
            </div>
	<div class="set-item clearfix">
		<span class="label">真实姓名<i class="nes-red">*</i></span>

		<div class="action-item nickname-item " style="height: 44px; line-height: 44px;">
		   {if !empty($userInfo['realname']) }
			<input class="realname" name="realname"  disabled value="{$userInfo['realname']}" placeholder="真实姓名" type="text"/>
           {else}
            <input class="realname" name="realname"   placeholder="真实姓名" type="text"/>
            {/if}
		</div>
	</div>
            {if empty($userInfo['from'])}
            <div class="set-item clearfix">
                <span class="label">修改密码<i class="nes-red">*</i></span>

                <div class="action-item nickname-item " style="height: 44px; line-height: 44px;">

                    <input class="password" name="password" placeholder="修改密码" type="text"/>

                </div>
            </div>
            {/if}
	<div class="set-item clearfix">
		<span class="label">性别</span>
		<div>
				<select id="sex" style="width:70px;height:30px" name="sex">
                    {if $userInfo['sex']==0}
					<option value="0" selected>女</option>
                    {else}
                    <option value="0" >女</option>
                    {/if}

                    {if $userInfo['sex']==1}
					<option selected value="1">男</option>
                    {else}
                    <option value="1">男</option>
                    {/if}

                    {if $userInfo['sex']==2}
					<option selected value="2">保密</option>
                    {else}
                    <option value="2">保密</option>
                    {/if}
				</select>			
		</div>
	</div>
	<div class="set-item clearfix">
		<span class="label">Email<i class="nes-red">*</i></span>
		<div class="action-item nickname-item " style="height: 44px; line-height: 44px;">
			<input class="email" name="email" value="{$userInfo['email']}" placeholder="Email" type="text"/>
		</div>
	</div>
<div class="set-item clearfix">
    <span class="label" name="birth">生日</span>
    <div>

            
            <select id="year" style="width:90px;height:30px" name="year">

                
                    <option data-value="2017">2017</option>
                    <option data-value="2016">2016</option>

                    <option data-value="2015">2015</option>

                
                    <option data-value="2014">2014</option>

                
                    <option data-value="2013">2013</option>

                
                    <option data-value="2012">2012</option>

                
                    <option data-value="2011">2011</option>

                
                    <option data-value="2010">2010</option>

                
                    <option data-value="2009">2009</option>

                
                    <option data-value="2008">2008</option>

                
                    <option data-value="2007">2007</option>

                
                    <option data-value="2006">2006</option>

                
                    <option data-value="2005">2005</option>

                
                    <option data-value="2004">2004</option>

                
                    <option data-value="2003">2003</option>

                
                    <option data-value="2002">2002</option>

                
                    <option data-value="2001">2001</option>

                
                    <option data-value="2000">2000</option>

                
                    <option data-value="1999">1999</option>

                
                    <option data-value="1998">1998</option>

                
                    <option data-value="1997">1997</option>

                
                    <option data-value="1996">1996</option>

                
                    <option data-value="1995">1995</option>

                
                    <option data-value="1994">1994</option>

                
                    <option data-value="1993">1993</option>

                
                    <option data-value="1992">1992</option>

                
                    <option data-value="1991">1991</option>

                
                    <option data-value="1990">1990</option>

                
                    <option data-value="1989">1989</option>

                
                    <option data-value="1988">1988</option>

                
                    <option data-value="1987">1987</option>

                
                    <option data-value="1986">1986</option>

                
                    <option data-value="1985">1985</option>

                
                    <option data-value="1984">1984</option>

                
                    <option data-value="1983">1983</option>

                
                    <option data-value="1982">1982</option>

                
                    <option data-value="1981">1981</option>

                
                    <option data-value="1980">1980</option>

                
                    <option data-value="1979">1979</option>

                
                    <option data-value="1978">1978</option>

                
                    <option data-value="1977">1977</option>

                
                    <option data-value="1976">1976</option>

                
                    <option data-value="1975">1975</option>

                
                    <option data-value="1974">1974</option>

                
                    <option data-value="1973">1973</option>

                
                    <option data-value="1972">1972</option>

                
                    <option data-value="1971">1971</option>

                
                    <option data-value="1970">1970</option>

                
                    <option data-value="1969">1969</option>

                
                    <option data-value="1968">1968</option>

                
                    <option data-value="1967">1967</option>

                
                    <option data-value="1966">1966</option>

                
                    <option data-value="1965">1965</option>

                
                    <option data-value="1964">1964</option>

                
                    <option data-value="1963">1963</option>

                
                    <option data-value="1962">1962</option>

                
                    <option data-value="1961">1961</option>

                
                    <option data-value="1960">1960</option>

                
                    <option data-value="1959">1959</option>

                
                    <option data-value="1958">1958</option>

                
                    <option data-value="1957">1957</option>

                
                    <option data-value="1956">1956</option>

                
                    <option data-value="1955">1955</option>

                
                    <option data-value="1954">1954</option>

                
                    <option data-value="1953">1953</option>

                
                    <option data-value="1952">1952</option>

                
                    <option data-value="1951">1951</option>

                
                    <option data-value="1950">1950</option>

                
            </select>
			<em>年</em>
        
		
            
            <select id="month" style="width:90px;height:30px" name="month">

                
                    <option data-value="01">01</option>

                
                    <option data-value="02">02</option>

                
                    <option data-value="03">03</option>

                
                    <option data-value="04">04</option>

                
                    <option data-value="05">05</option>

                
                    <option data-value="06">06</option>

                
                    <option data-value="07">07</option>

                
                    <option data-value="08">08</option>

                
                    <option data-value="09">09</option>

                
                    <option data-value="10">10</option>

                
                    <option data-value="11">11</option>

                
                    <option data-value="12">12</option>

                
            </select>
			<em>月</em>
            <select id="day" style="width:90px;height:30px" name="day">

                
                    <option data-value="01">01</option>

                
                    <option data-value="02">02</option>

                
                    <option data-value="03">03</option>

                
                    <option data-value="04">04</option>

                
                    <option data-value="05">05</option>

                
                    <option data-value="06">06</option>

                
                    <option data-value="07">07</option>

                
                    <option data-value="08">08</option>

                
                    <option data-value="09">09</option>

                
                    <option data-value="10">10</option>

                
                    <option data-value="11">11</option>

                
                    <option data-value="12">12</option>

                
                    <option data-value="13">13</option>

                
                    <option data-value="14">14</option>

                
                    <option data-value="15">15</option>

                
                    <option data-value="16">16</option>

                
                    <option data-value="17">17</option>

                
                    <option data-value="18">18</option>

                
                    <option data-value="19">19</option>

                
                    <option data-value="20">20</option>

                
                    <option data-value="21">21</option>

                
                    <option data-value="22">22</option>

                
                    <option data-value="23">23</option>

                
                    <option data-value="24">24</option>

                
                    <option data-value="25">25</option>

                
                    <option data-value="26">26</option>

                
                    <option data-value="27">27</option>

                
                    <option data-value="28">28</option>

                
                    <option data-value="29">29</option>

                
                    <option data-value="30">30</option>

                
                    <option data-value="31">31</option>

                
            </select>
        <em>日</em>
    </div>
</div>

<style type="text/css">
body{ background:#EEEEEE;margin:0; padding:0; font-family:"微软雅黑", Arial, Helvetica, sans-serif; }
a{ color:#006600; text-decoration:none;}
a:hover{color:#990000;}
.top{ margin:15px auto; color:#990000; text-align:center;}
.info select{ border:1px #993300 solid; background:#FFFFFF;}
.info{ margin:5px; text-align:center;margin-left:-120px}
.info #show{ color:#3399FF; }
.bottom{ text-align:right; font-size:12px; color:#CCCCCC; width:1000px;}
</style>
	<div class="set-item clearfix">
		<span class="label" name="address">所在地区</span>
	<div class="info">
		<div style="margin-left:-250px">
		<select id="s_province" name="s_province"></select>  
		<select id="s_city" name="s_city"></select>  
		<select id="s_county" name="s_county" ></select>
		<script class="resources library" src="__JS_PATH__/area.js" type="text/javascript"></script>

		<script type="text/javascript">_init_area();</script>
		</div>
		<div id="show"></div>
	</div>
	<script type="text/javascript">
        var Gid  = document.getElementById ;
        var showArea =function(){
            Gid('show').innerHTML = "<h3>省" + Gid('s_province').value + " - 市" +
            Gid('s_city').value + " - 县/区" +
            Gid('s_county').value + "</h3>";
        }
     //  Gid('s_county').setAttribute('onchange','showArea()');
	</script>
	</div>


	<div class="set-item clearfix">
		<span class="label">简介</span>
		<div><textarea name="profile" id="summary">{$userInfo['summary']}</textarea></div>
	</div>
	<div>
		 <div class="set-save">
			<input type="button" value="修改" id="btn" name="btn" style="width:300px;height:44px"/>
		 </div>
	 </div>  
 </div> 
</div>

    <script>
        //验证邮箱的函数
        function isEmail(str){
            //邮箱的正则表达式
            var reg = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;
            return reg.test(str);
        }
        //加载图片函数
        function uploadImage() {
            //获取上传的图片路径
            var imgPath=null;
            // FormData对象，来发送二进制文件。
            var formdata = new FormData();
            // 将文件追加到 formdata对象中。
            formdata.append("myfile", document.getElementById('id-publish-btn').files[0]);
            $.ajax({
                type: "POST",
                url: "{:url('/?s=index/user/uploadImg')}",
                data: formdata,
                /**
                 * 必须false才会避开jQuery对 formdata 的默认处理
                 * XMLHttpRequest会对 formdata 进行正确的处理
                 */
                processData: false,
                // 告诉jQuery不要去设置Content-Type请求头
                contentType: false,
                dataType: "json",
                success: function (data) {
                    imgPath=data.msg;
                    $('#myImg').attr('src',data.msg);
                },
            });
            return imgPath;
        }
        //匿名检测
        $('.nickname').blur(function () {

            if($('.nickname').val().length<5 ||$('.nickname').val().length>10 ){
                    swal('):',"用户名长度5-10位",'success');
                    return ;
            }
        });
        //实名认证检测
        $('.realname').blur(function(){
            swal({
                title: "实名认证!!!",
                text: "是否要进行实名认证?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Yes"
            });
        });
        //邮箱检测
        $('.email').blur(function(){
           // alert($('.email').val());
            if(!isEmail($('.email').val())){
                sweetAlert('):','邮箱格式不对','error');
                return ;
            }
        });
        //性别
        var sex=$('#sex').val();
      //  alert(sex);
        //年
        var year=$('#year').val();
        //月
        var month=$('#month').val();
        //日
        var day=$('#day').val();
        //出生年月日
        var birthday=year+'-'+month+'-'+day;
        //省份

         //简介
         var summary=$('#summary').val();

         //头像地址
       // var imagePath= $('#myImg')[0].src;
         $('#btn').click(function(){

             if($('.nickname').val().length<5 ||$('.nickname').val().length>10 ){

                 sweetAlert('):','用户名5-10位','error');
                    return;
             }
             $.post("{:url('/?s=index/user/doModify')}",{
                 "image":$('#myImg')[0].src,
                 "sex":$('#sex').val(),
                 "birthday":$('#year').val()+'-'+$('#month').val()+'-'+$('#day').val(),
                 "address":$('#s_province').val()+'-'+$('#s_city').val()+'-'+$('#s_county').val(),
                 "nickname":$('.nickname').val(),
                 "realname":$('.realname').val(),
                 "summary":$('#summary').val(),
                 "email":$('.email').val(),
                 "password":$('.password').val()
             },function(data){

                    if(data.status){
                        swal('^_^',data.msg,'success');

                        if(data.realname){
                            $('.realname').val(data.realname);
                            $('.realname').attr("disabled",true);
                            if(data.type==1){
                                swal('^_^','您已经实名升级为超级会员','success');
                            }else if(data.type==2){
                                swal('^_^','您是管理员','success');
                            }else if(data.type==3){
                                swal('^_^','您是超级管理员','success');
                            }
                        }
                    }else{
                        sweetAlert("):",data.msg,'error');
                    }
             });
         });
    </script>
</div>
</body>
</html>
